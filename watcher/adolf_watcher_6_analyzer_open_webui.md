---
title: "–†–∞–∑–¥–µ–ª 6: Analyzer –∏ Open WebUI"
mode: "wide"
---

**–ü—Ä–æ–µ–∫—Ç:** ADOLF ‚Äî AI-Driven Operations Layer Framework  
**–ú–æ–¥—É–ª—å:** Watcher / Analyzer  
**–í–µ—Ä—Å–∏—è:** 4.0  
**–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2026

---

## 6.1 –û–±–∑–æ—Ä

Analyzer ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞ Watcher, —Ä–∞–±–æ—Ç–∞—é—â–∞—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ ADOLF. –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –º–æ–¥—É–ª—è Knowledge (Qdrant), –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ Open WebUI.

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç Collector (Node.js, VPS), Analyzer –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É ADOLF: FastAPI, PostgreSQL, Celery, Open WebUI.

```mermaid
flowchart TB
    subgraph VPS["VPS ‚Äî Collector"]
        SQLITE[("SQLite<br/>watcher.db")]
        API_COL["REST API :3002"]
        KP["Knowledge Pipeline"]
    end

    subgraph MAIN["–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä ‚Äî ADOLF"]
        subgraph ANALYZER["Analyzer"]
            FAST["FastAPI<br/>watcher_analyzer"]
            CELERY_W["Celery Worker"]
            CELERY_B["Celery Beat"]
        end

        subgraph KNOWLEDGE["Knowledge"]
            INPUT["–í—Ö–æ–¥–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è<br/>/data/knowledge/incoming/watcher"]
            ETL["ETL Pipeline"]
            QDRANT[("Qdrant<br/>vector DB")]
        end

        subgraph OWUI["Open WebUI"]
            PIPE["Pipeline<br/>@Adolf_Watcher"]
            TOOLS["Watcher Tools"]
        end

        CORE_DB[("PostgreSQL<br/>watcher_* —Ç–∞–±–ª–∏—Ü—ã")]
        REDIS[("Redis")]
    end

    KP -->|"Markdown –ø–æ —Å–µ—Ç–∏"| INPUT
    INPUT --> ETL
    ETL --> QDRANT

    QDRANT --> FAST
    FAST --> CORE_DB
    FAST --> CELERY_W
    CELERY_B --> REDIS --> CELERY_W

    PIPE --> FAST
    TOOLS --> FAST

    API_COL -.->|"HTTP (—Ä–µ–∑–µ—Ä–≤)"| FAST
```

### –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| Knowledge Pipeline (Collector) | üî≤ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è |
| Markdown-–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä | üî≤ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è |
| Analyzer FastAPI | üî≤ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è |
| Open WebUI Tools | üî≤ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è |
| Open WebUI Pipeline | üî≤ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è |
| Celery-–∑–∞–¥–∞—á–∏ | üî≤ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è |

---

## 6.2 Knowledge Pipeline

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Knowledge Pipeline –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–¥–Ω–æ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö: Collector (VPS) ‚Üí Knowledge (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä). –î–∞–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ JSON –≤ Markdown —Å YAML-–∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –º–æ–¥—É–ª—å Knowledge –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ Qdrant.

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```mermaid
sequenceDiagram
    participant RN as Runner (VPS)
    participant DB as SQLite
    participant KP as Knowledge Pipeline
    participant FS as Network FS
    participant ETL as Knowledge ETL
    participant QD as Qdrant

    RN->>DB: Enrich completed
    RN->>KP: triggerPipeline(sellerId)

    KP->>DB: SELECT product_details WHERE seller_rowid = ?
    KP->>DB: SELECT price_history (last 2 scans for diff)

    KP->>KP: generateMarkdown(seller, products, diff)
    KP->>FS: Write .md to /data/knowledge/incoming/watcher/

    Note over FS: –ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ —Å–µ—Ç–∏<br/>(NFS / rsync / scp)

    ETL->>FS: Watch for new files
    ETL->>QD: Chunk + Embed + Index
```

### –¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

| –¢–∏–ø | –§–∞–π–ª | –¢—Ä–∏–≥–≥–µ—Ä | –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ |
|-----|------|---------|------------|
| –û–±–æ–≥–∞—â—ë–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ | `{mp}_seller_{id}_catalog.md` | –ü–æ—Å–ª–µ enrich | –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –≤—Å–µ–º SKU |
| –¶–µ–Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è | `{mp}_seller_{id}_diff.md` | –ü–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ scan | Diff –º–µ–∂–¥—É –¥–≤—É–º—è —Å–∫–∞–Ω–∞–º–∏ |
| –°–≤–æ–¥–∫–∞ –ø–æ –ø—Ä–æ–¥–∞–≤—Ü—É | `{mp}_seller_{id}_summary.md` | –ü–æ—Å–ª–µ scan | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ |

### –§–æ—Ä–º–∞—Ç Markdown-–¥–æ–∫—É–º–µ–Ω—Ç–∞

#### YAML-–∑–∞–≥–æ–ª–æ–≤–æ–∫

```yaml
---
title: "–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç: Seller Name (Wildberries)"
category: competitive_intelligence
subcategory: enriched_catalog
marketplace: wildberries
seller_id: "1025130"
seller_name: "Seller Name"
enrichment_date: "2026-02-14"
total_products: 142
brand_id: all
access_level: manager
source: watcher_collector
---
```

–ü–æ–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º –¥–ª—è RAG-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –≤ Knowledge:

| –ü–æ–ª–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤ RAG |
|------|-----------------|
| `category` | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –¥–∞–Ω–Ω—ã—Ö (`competitive_intelligence`) |
| `subcategory` | –£—Ç–æ—á–Ω–µ–Ω–∏–µ: `enriched_catalog`, `price_diff`, `seller_summary` |
| `marketplace` | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—É |
| `seller_id` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ |
| `brand_id` | –†–æ–ª–µ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (`all` = –¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º –±—Ä–µ–Ω–¥–∞–º) |
| `access_level` | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ |

#### –¢–µ–ª–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–æ–±–æ–≥–∞—â—ë–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥)

```markdown
# –ö–∞—Ç–∞–ª–æ–≥: Seller Name (Wildberries)

**–î–∞—Ç–∞ –æ–±–æ–≥–∞—â–µ–Ω–∏—è:** 2026-02-14
**–¢–æ–≤–∞—Ä–æ–≤:** 142
**–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:** 2 450 ‚ÇΩ
**–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥:** 4.6

## –¢–æ–≤–∞—Ä—ã

### SKU 123456789 ‚Äî –ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ –º–∏–¥–∏

- **–¶–µ–Ω–∞:** 2 990 ‚ÇΩ (—Å—Ç–∞—Ä–∞—è: 5 980 ‚ÇΩ, —Å–∫–∏–¥–∫–∞ 50%)
- **–†–µ–π—Ç–∏–Ω–≥:** 4.7 (1 284 –æ—Ç–∑—ã–≤–∞, 5 420 –ø—Ä–æ–¥–∞–∂)
- **–ù–∞–ª–∏—á–∏–µ:** 47 —à—Ç (—Ä–∞–∑–º–µ—Ä—ã: 42, 44, 46, 48, 50)
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –õ—ë–≥–∫–æ–µ –ø–ª–∞—Ç—å–µ –∏–∑ –≤–∏—Å–∫–æ–∑—ã...
- **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:** –°–æ—Å—Ç–∞–≤: –≤–∏—Å–∫–æ–∑–∞ 100%; –¶–≤–µ—Ç: –∫—Ä–∞—Å–Ω—ã–π; –°–µ–∑–æ–Ω: –ª–µ—Ç–æ
- **–ü—Ä–æ–¥–∞–≤–µ—Ü:** –û–û–û –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç (–û–ì–†–ù 1234567890123)

### SKU 234567890 ‚Äî –•—É–¥–∏ –æ–≤–µ—Ä—Å–∞–π–∑

...
```

#### –¢–µ–ª–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (—Ü–µ–Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

```markdown
# –¶–µ–Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: Seller Name (Wildberries)

**–ü–µ—Ä–∏–æ–¥:** 2026-02-12 ‚Üí 2026-02-14
**–ù–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤:** 3
**–£–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤:** 1
**–ò–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω:** 12

## –ü–æ–¥–æ—Ä–æ–∂–∞–≤—à–∏–µ (5)

- SKU 123456789 ¬´–ü–ª–∞—Ç—å–µ –ª–µ—Ç–Ω–µ–µ¬ª: 2 500 ‚ÇΩ ‚Üí 2 990 ‚ÇΩ (+19.6%)
- ...

## –ü–æ–¥–µ—à–µ–≤–µ–≤—à–∏–µ (7)

- SKU 345678901 ¬´–•—É–¥–∏ –æ–≤–µ—Ä—Å–∞–π–∑¬ª: 4 300 ‚ÇΩ ‚Üí 3 010 ‚ÇΩ (‚àí30.0%)
- ...

## –ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã (3)

- SKU 456789012 ¬´–Æ–±–∫–∞ –º–∏–¥–∏¬ª ‚Äî 1 890 ‚ÇΩ, —Ä–µ–π—Ç–∏–Ω–≥ 0 (–Ω–æ–≤–∏–Ω–∫–∞)
- ...

## –°–Ω—è—Ç—ã–µ —Å –ø—Ä–æ–¥–∞–∂–∏ (1)

- SKU 567890123 ¬´–®–∞–ø–∫–∞ –∑–∏–º–Ω—è—è¬ª ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞ 990 ‚ÇΩ
```

### –ü–µ—Ä–µ–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-------|----------|:---------:|
| rsync –ø–æ SSH | `rsync -az /opt/watcher/knowledge/ user@main:/data/knowledge/incoming/watcher/` | 1 |
| NFS mount | –°–µ—Ç–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ VPS | 2 |
| scp | –ü—Ä–æ—Å—Ç–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ | 3 |

–ü–µ—Ä–µ–¥–∞—á–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–≥–æ Markdown-–¥–æ–∫—É–º–µ–Ω—Ç–∞. Celery Beat –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –≤—Ö–æ–¥–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é.

---

## 6.3 Analyzer: FastAPI-—Å–µ—Ä–≤–∏—Å

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ ADOLF Core

```python
# –ü—Ä–æ–º–ø—Ç –¥–ª—è Claude Code:
#
# –°–æ–∑–¥–∞–π FastAPI-—Ä–æ—É—Ç–µ—Ä –¥–ª—è –º–æ–¥—É–ª—è Watcher Analyzer.
# –§–∞–π–ª: /opt/adolf/modules/watcher/router.py
# Prefix: /api/v1/watcher
# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: Knowledge (Qdrant), PostgreSQL, Redis
# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: —á–µ—Ä–µ–∑ ADOLF Core Middleware (depends=[check_role("manager")])
# –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã: —Å–º. —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –Ω–∏–∂–µ
```

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### –¶–µ–Ω—ã –∏ —Ç–æ–≤–∞—Ä—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –†–æ–ª–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:-----:|------|:----:|----------|
| GET | `/api/v1/watcher/prices/{sku}` | Manager+ | –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –∏ –∏—Å—Ç–æ—Ä–∏—è –ø–æ SKU |
| GET | `/api/v1/watcher/prices/{sku}/history` | Manager+ | –¶–µ–Ω–æ–≤–∞—è –∏—Å—Ç–æ—Ä–∏—è –∑–∞ –ø–µ—Ä–∏–æ–¥ |
| GET | `/api/v1/watcher/sellers/{seller_id}/products` | Manager+ | –¢–æ–≤–∞—Ä—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ |
| GET | `/api/v1/watcher/sellers/{seller_id}/enriched` | Manager+ | –û–±–æ–≥–∞—â—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| GET | `/api/v1/watcher/sellers/{seller_id}/diff` | Manager+ | –¶–µ–Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è |

#### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –†–æ–ª–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:-----:|------|:----:|----------|
| GET | `/api/v1/watcher/analytics/pricing` | Manager+ | –¶–µ–Ω–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (—Å–≤–æ–¥–∫–∞ –ø–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º) |
| GET | `/api/v1/watcher/analytics/assortment` | Manager+ | –ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ |
| GET | `/api/v1/watcher/analytics/trends` | Manager+ | –¢—Ä–µ–Ω–¥–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |
| GET | `/api/v1/watcher/compare` | Manager+ | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –º–µ–∂–¥—É —Å–æ–±–æ–π |

#### –ê–ª–µ—Ä—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –†–æ–ª–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:-----:|------|:----:|----------|
| GET | `/api/v1/watcher/alerts` | Manager+ | –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤ |
| PUT | `/api/v1/watcher/alerts/{id}/read` | Manager+ | –ü–æ–º–µ—Ç–∏—Ç—å –∞–ª–µ—Ä—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º |
| GET | `/api/v1/watcher/alerts/settings` | Admin | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä–æ–≥–æ–≤ |
| PUT | `/api/v1/watcher/alerts/settings` | Admin | –û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Ä–æ–≥–∏ |

#### –ü–æ–¥–ø–∏—Å–∫–∏

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –†–æ–ª–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:-----:|------|:----:|----------|
| GET | `/api/v1/watcher/subscriptions` | Manager+ | –°–ø–∏—Å–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ |
| POST | `/api/v1/watcher/subscriptions` | Manager+ | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è |
| DELETE | `/api/v1/watcher/subscriptions/{id}` | Manager+ | –£–¥–∞–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É |

#### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –†–æ–ª–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:-----:|------|:----:|----------|
| GET | `/api/v1/watcher/status` | Admin | –°—Ç–∞—Ç—É—Å Collector (–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ :3002) |
| POST | `/api/v1/watcher/command` | Admin | –ö–æ–º–∞–Ω–¥–∞ Collector (—á–µ—Ä–µ–∑ API :3002) |

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

Analyzer –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–≤—É—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:

```mermaid
flowchart LR
    subgraph PRIMARY["–û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫"]
        QD[("Qdrant<br/>(Knowledge)")] -->|"RAG-–∑–∞–ø—Ä–æ—Å—ã"| AZ["Analyzer"]
    end

    subgraph FALLBACK["–†–µ–∑–µ—Ä–≤–Ω—ã–π (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø)"]
        COL["Collector API<br/>:3002 —á–µ—Ä–µ–∑ VPN"] -.->|"HTTP GET"| AZ
    end

    AZ --> PG[("PostgreSQL<br/>(–∫—ç—à –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)")]
```

–û—Å–Ω–æ–≤–Ω–æ–π: Qdrant —á–µ—Ä–µ–∑ RAG-–∑–∞–ø—Ä–æ—Å—ã –∫ –º–æ–¥—É–ª—é Knowledge. –î–∞–Ω–Ω—ã–µ —É–∂–µ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–∏—Å–∫–æ–º.

–†–µ–∑–µ—Ä–≤–Ω—ã–π: –ø—Ä—è–º–æ–π HTTP-–¥–æ—Å—Ç—É–ø –∫ REST API Collector (–ø–æ—Ä—Ç 3002) —á–µ—Ä–µ–∑ VPN –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è real-time –¥–∞–Ω–Ω—ã—Ö (—Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á, –ø—É–ª –ü–ö) –∏–ª–∏ –∫–æ–≥–¥–∞ Knowledge Pipeline –µ—â—ë –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ.

---

## 6.4 Open WebUI Tools

### –°–ø–∏—Å–æ–∫ Tools

| Tool | –û–ø–∏—Å–∞–Ω–∏–µ | –†–æ–ª–∏ |
|------|----------|:----:|
| `watcher_get_prices` | –¢–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –ø–æ SKU | Manager+ |
| `watcher_price_history` | –ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω –∑–∞ –ø–µ—Ä–∏–æ–¥ | Manager+ |
| `watcher_compare_competitors` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω–æ–≤–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è | Manager+ |
| `watcher_add_subscription` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ | Manager+ |
| `watcher_list_subscriptions` | –°–ø–∏—Å–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ | Manager+ |
| `watcher_get_alerts` | –ê–∫—Ç–∏–≤–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã –æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞—Ö | Manager+ |
| `watcher_mark_alert_read` | –ü–æ–º–µ—Ç–∏—Ç—å –∞–ª–µ—Ä—Ç –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º | Manager+ |
| `watcher_agent_status` | –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã Collector | Admin |
| `watcher_agent_command` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Collector | Admin |
| `watcher_settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–ª–µ—Ä—Ç–æ–≤ –∏ –ø–æ—Ä–æ–≥–æ–≤ | Admin |

### watcher\_get\_prices

```python
# –ü—Ä–æ–º–ø—Ç –¥–ª—è Claude Code:
#
# –°–æ–∑–¥–∞–π Open WebUI Tool: watcher_get_prices
# –§–∞–π–ª: /opt/adolf/tools/watcher_get_prices.py
#
# –û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è LLM:
#   "–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö —Ü–µ–Ω –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ –ø–æ SKU.
#    –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ —Ü–µ–Ω–∞—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤,
#    —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞—Ö, –∏–ª–∏ –ø—Ä–æ—Å–∏—Ç —Å—Ä–∞–≤–Ω–∏—Ç—å —Ü–µ–Ω—ã."
#
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
#   sku: str ‚Äî –∞—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞
#   marketplace: Optional[str] ‚Äî —Ñ–∏–ª—å—Ç—Ä –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
#
# –õ–æ–≥–∏–∫–∞:
#   1. –ó–∞–ø—Ä–æ—Å –∫ Analyzer API: GET /api/v1/watcher/prices/{sku}
#   2. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –≤ Markdown-—Ç–∞–±–ª–∏—Ü—É
#   3. –ï—Å–ª–∏ –µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫ (ASCII –∏–ª–∏ —Å—Å—ã–ª–∫–∞)
#
# –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
#   "## –¶–µ–Ω—ã –Ω–∞ SKU 123456789
#    | –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç | –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å | –¶–µ–Ω–∞ | –°–∫–∏–¥–∫–∞ | –†–µ–π—Ç–∏–Ω–≥ |
#    |-----------|-------------|------|--------|---------|
#    | Seller A  | WB          | 2990 | -50%   | 4.7     |
#    | Seller B  | Ozon        | 3150 | -40%   | 4.5     |
#    
#    üìä –î–∏–Ω–∞–º–∏–∫–∞ –∑–∞ 30 –¥–Ω–µ–π: 3500 ‚Üí 2990 (‚àí14.6%)"
```

### watcher\_compare\_competitors

```python
# –ü—Ä–æ–º–ø—Ç –¥–ª—è Claude Code:
#
# –°–æ–∑–¥–∞–π Open WebUI Tool: watcher_compare_competitors
# –§–∞–π–ª: /opt/adolf/tools/watcher_compare_competitors.py
#
# –û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è LLM:
#   "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω–æ–≤–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤.
#    –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç —Å—Ä–∞–≤–Ω–∏—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤,
#    –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏–ª–∏ –Ω–∞–π—Ç–∏ –ª—É—á—à—É—é —Ü–µ–Ω—É."
#
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
#   seller_ids: List[str] ‚Äî ID –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
#   marketplace: Optional[str]
#   category: Optional[str] ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
#
# –õ–æ–≥–∏–∫–∞:
#   1. RAG-–∑–∞–ø—Ä–æ—Å –∫ Knowledge: "—Ü–µ–Ω–æ–≤–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ {sellers}"
#   2. –ï—Å–ª–∏ RAG –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Äî fallback –∫ Collector API
#   3. –ê–≥—Ä–µ–≥–∞—Ü–∏—è: —Å—Ä–µ–¥–Ω–∏–µ —Ü–µ–Ω—ã, —Å–∫–∏–¥–∫–∏, –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç
#   4. AI-–∞–Ω–∞–ª–∏–∑ (GPT-5 mini): –≤—ã—è–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
#
# –û—Ç–≤–µ—Ç: —Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ + AI-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
```

### watcher\_get\_alerts

```python
# –ü—Ä–æ–º–ø—Ç –¥–ª—è Claude Code:
#
# –°–æ–∑–¥–∞–π Open WebUI Tool: watcher_get_alerts
# –§–∞–π–ª: /opt/adolf/tools/watcher_get_alerts.py
#
# –û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è LLM:
#   "–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–æ–≤ –æ –∑–Ω–∞—á–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤.
#    –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ –Ω–æ–≤–æ—Å—Ç—è—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤,
#    –≤–∞–∂–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Ü–µ–Ω –∏–ª–∏ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞."
#
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
#   status: str = "unread" ‚Äî —Ñ–∏–ª—å—Ç—Ä (unread | all)
#   limit: int = 10
#
# –¢–∏–ø—ã –∞–ª–µ—Ä—Ç–æ–≤:
#   price_drop ‚Äî —Å–Ω–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã > –ø–æ—Ä–æ–≥–∞
#   new_product ‚Äî –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
#   bestseller ‚Äî —Ç–æ–≤–∞—Ä –ø–æ–ª—É—á–∏–ª –±–µ–π–¥–∂ ¬´–ë–µ—Å—Ç—Å–µ–ª–ª–µ—Ä¬ª
#   mass_removal ‚Äî –º–∞—Å—Å–æ–≤—ã–π –≤—ã–≤–æ–¥ —Ç–æ–≤–∞—Ä–æ–≤ (>10% –∑–∞ –¥–µ–Ω—å)
#   review_surge ‚Äî —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç –æ—Ç–∑—ã–≤–æ–≤
#
# –û—Ç–≤–µ—Ç: —Å–ø–∏—Å–æ–∫ –∞–ª–µ—Ä—Ç–æ–≤ —Å —ç–º–æ–¥–∑–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏
```

### watcher\_agent\_status (Admin)

```python
# –ü—Ä–æ–º–ø—Ç –¥–ª—è Claude Code:
#
# –°–æ–∑–¥–∞–π Open WebUI Tool: watcher_agent_status
# –§–∞–π–ª: /opt/adolf/tools/watcher_agent_status.py
#
# –û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è LLM:
#   "–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö Watcher Collector.
#    –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤."
#
# –õ–æ–≥–∏–∫–∞:
#   1. HTTP GET –∫ Collector API: /api/v1/pool/summary
#   2. HTTP GET –∫ Collector API: /api/v1/tasks
#   3. HTTP GET –∫ Collector API: /api/v1/stats
#   4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —á–∏—Ç–∞–µ–º—ã–π –æ—Ç—á—ë—Ç
#
# –û—Ç–≤–µ—Ç:
#   "## –°—Ç–∞—Ç—É—Å Watcher Collector
#    üñ•Ô∏è –ü–ö: 3 –≤—Å–µ–≥–æ, 2 –æ–Ω–ª–∞–π–Ω, 1 –∑–∞–Ω—è—Ç, 1 —Å–≤–æ–±–æ–¥–µ–Ω
#    üìã –ó–∞–¥–∞—á–∏: 1 –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, 3 –≤ –æ—á–µ—Ä–µ–¥–∏
#    üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 12 –ø—Ä–æ–¥–∞–≤—Ü–æ–≤, 287 —Å–∫–∞–Ω–æ–≤, 15420 —Ç–æ–≤–∞—Ä–æ–≤"
```

---

## 6.5 Open WebUI Pipeline

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```yaml
# open_webui/config/pipelines.yaml
pipelines:
  - name: Adolf_Watcher
    module: pipelines.watcher_pipeline
    class: WatcherPipeline
    enabled: true
    access_roles: ["manager", "senior", "director", "admin"]
    tools: true
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

Pipeline –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç intent –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π Tool.

```mermaid
flowchart TB
    MSG["–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è<br/>@Adolf_Watcher"] --> INLET["inlet():<br/>–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏"]

    INLET --> INTENT{"Intent detection<br/>(GPT-5 mini)"}

    INTENT -->|"—Ü–µ–Ω–∞ / —Å—Ç–æ–∏–º–æ—Å—Ç—å"| T1["watcher_get_prices"]
    INTENT -->|"–∏—Å—Ç–æ—Ä–∏—è / –¥–∏–Ω–∞–º–∏–∫–∞"| T2["watcher_price_history"]
    INTENT -->|"—Å—Ä–∞–≤–Ω–∏—Ç—å / –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã"| T3["watcher_compare_competitors"]
    INTENT -->|"–∞–ª–µ—Ä—Ç—ã / –Ω–æ–≤–æ—Å—Ç–∏"| T4["watcher_get_alerts"]
    INTENT -->|"–¥–æ–±–∞–≤–∏—Ç—å / –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å"| T5["watcher_add_subscription"]
    INTENT -->|"—Å–ø–∏—Å–æ–∫ / –ø–æ–¥–ø–∏—Å–∫–∏"| T6["watcher_list_subscriptions"]
    INTENT -->|"—Å—Ç–∞—Ç—É—Å / –∞–≥–µ–Ω—Ç—ã (admin)"| T7["watcher_agent_status"]

    T1 & T2 & T3 & T4 & T5 & T6 & T7 --> OUTLET["outlet():<br/>—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞"]
    OUTLET --> RESP["–û—Ç–≤–µ—Ç –≤ —á–∞—Ç–µ"]
```

### –ü—Ä–∏–º–µ—Ä—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

| –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | Intent | Tool | –û—Ç–≤–µ—Ç |
|---------------------|--------|------|-------|
| ¬´–ö–∞–∫–∞—è —Ü–µ–Ω–∞ –Ω–∞ –∞—Ä—Ç–∏–∫—É–ª 12345?¬ª | price\_query | watcher\_get\_prices | –¢–∞–±–ª–∏—Ü–∞ —Ü–µ–Ω –ø–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º |
| ¬´–ö–∞–∫ –º–µ–Ω—è–ª–∞—Å—å —Ü–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ 12345 –∑–∞ –º–µ—Å—è—Ü?¬ª | price\_history | watcher\_price\_history | –ì—Ä–∞—Ñ–∏–∫ + —Ç–∞–±–ª–∏—Ü–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| ¬´–°—Ä–∞–≤–Ω–∏ —Ü–µ–Ω—ã Seller A –∏ Seller B¬ª | compare | watcher\_compare\_competitors | –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ + AI-–∞–Ω–∞–ª–∏–∑ |
| ¬´–ß—Ç–æ –Ω–æ–≤–æ–≥–æ —É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤?¬ª | alerts | watcher\_get\_alerts | –°–ø–∏—Å–æ–∫ –∞–ª–µ—Ä—Ç–æ–≤ |
| ¬´–î–æ–±–∞–≤—å –ø—Ä–æ–¥–∞–≤—Ü–∞ 1025130 —Å WB¬ª | subscribe | watcher\_add\_subscription | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è |
| ¬´–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã —Å–±–æ—Ä–∞¬ª | admin\_status | watcher\_agent\_status | –û—Ç—á—ë—Ç –æ Collector |

---

## 6.6 Celery-–∑–∞–¥–∞—á–∏

### –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (Celery Beat)

| –ó–∞–¥–∞—á–∞ | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|:----------:|----------|
| `watcher.sync_knowledge` | –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Knowledge, –∑–∞–ø—É—Å–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ |
| `watcher.generate_alerts` | –ö–∞–∂–¥—ã–π —á–∞—Å | –ê–Ω–∞–ª–∏–∑ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤ |
| `watcher.refresh_analytics` | –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ | –ü–µ—Ä–µ—Å—á—ë—Ç –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫ (–∫—ç—à –≤ PostgreSQL) |
| `watcher.cleanup_alerts` | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 03:00 | –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π |
| `watcher.collector_health` | –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Collector API |

### –ó–∞–¥–∞—á–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É

| –ó–∞–¥–∞—á–∞ | –¢—Ä–∏–≥–≥–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|---------|----------|
| `watcher.analyze_seller` | Tool –≤—ã–∑–æ–≤ | –ì–ª—É–±–æ–∫–∏–π AI-–∞–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ (Claude Opus 4.5) |
| `watcher.export_data` | Tool –≤—ã–∑–æ–≤ (Senior+) | –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ XLSX |
| `watcher.forward_command` | Tool –≤—ã–∑–æ–≤ (Admin) | –ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–º–∞–Ω–¥—ã Collector API |

---

## 6.7 –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏

### –¶–µ–Ω–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

Analyzer —Å—Ç—Ä–æ–∏—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Knowledge (Qdrant):

| –ú–µ—Ç—Ä–∏–∫–∞ | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö | AI-–º–æ–¥–µ–ª—å |
|---------|-----------------|-----------|
| –î–∏–Ω–∞–º–∏–∫–∞ —Ü–µ–Ω –ø–æ SKU | `price_diff` –¥–æ–∫—É–º–µ–Ω—Ç—ã | –ë–µ–∑ AI (—Ä–∞—Å—á—ë—Ç) |
| –°—Ä–µ–¥–Ω—è—è —Å–∫–∏–¥–∫–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞ | `enriched_catalog` –¥–æ–∫—É–º–µ–Ω—Ç—ã | –ë–µ–∑ AI (—Ä–∞—Å—á—ë—Ç) |
| –ß–∞—Å—Ç–æ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω | `price_diff` –∑–∞ –ø–µ—Ä–∏–æ–¥ | –ë–µ–∑ AI (—Ä–∞—Å—á—ë—Ç) |
| –¶–µ–Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ | –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ–¥–∞–≤—Ü–∞ | GPT-5 mini |
| –¶–µ–Ω–æ–≤–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ | –ö–∞—Ç–∞–ª–æ–≥–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ | GPT-5 mini |

### –ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö | AI-–º–æ–¥–µ–ª—å |
|---------|-----------------|-----------|
| –°–∫–æ—Ä–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | `price_diff` (new/removed) | –ë–µ–∑ AI |
| –ì–ª—É–±–∏–Ω–∞ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ | `enriched_catalog` | –ë–µ–∑ AI |
| –ë–µ—Å—Ç—Å–µ–ª–ª–µ—Ä—ã –∏ –∞—É—Ç—Å–∞–π–¥–µ—Ä—ã | `enriched_catalog` (rating, reviews) | –ë–µ–∑ AI |
| ABC-–∞–Ω–∞–ª–∏–∑ | `enriched_catalog` | –ë–µ–∑ AI |
| –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –Ω–∞—à–∏–º –∫–∞—Ç–∞–ª–æ–≥–æ–º | Knowledge (watcher + own products) | GPT-5 mini |

### –ê–ª–µ—Ä—Ç—ã

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:

| –ê–ª–µ—Ä—Ç | –£—Å–ª–æ–≤–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | –ü–∞—Ä–∞–º–µ—Ç—Ä |
|-------|------------------------|----------|
| –†–µ–∑–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã | price\_change &lt; ‚àí15% | `alert_price_drop_pct` |
| –†–µ–∑–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ü–µ–Ω—ã | price\_change &gt; +20% | `alert_price_rise_pct` |
| –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | new\_product –≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | `alert_categories[]` |
| –ë–µ–π–¥–∂ ¬´–ë–µ—Å—Ç—Å–µ–ª–ª–µ—Ä¬ª | badge = '–ë–µ—Å—Ç—Å–µ–ª–ª–µ—Ä' (–Ω–æ–≤—ã–π) | ‚Äî |
| –ú–∞—Å—Å–æ–≤—ã–π –≤—ã–≤–æ–¥ | removed &gt; 10% –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ –∑–∞ –¥–µ–Ω—å | `alert_mass_removal_pct` |
| –†–æ—Å—Ç –æ—Ç–∑—ã–≤–æ–≤ | reviews\_count delta &gt; +50 –∑–∞ —Å—É—Ç–∫–∏ | `alert_review_surge` |

–ü–æ—Ä–æ–≥–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —á–µ—Ä–µ–∑ Tool `watcher_settings` –∏–ª–∏ —á–µ—Ä–µ–∑ API.

---

## 6.8 –°—Ö–µ–º–∞ PostgreSQL (Analyzer)

Analyzer —Ö—Ä–∞–Ω–∏—Ç –∫—ç—à –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ PostgreSQL –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.

```sql
-- –ê–ª–µ—Ä—Ç—ã
CREATE TABLE watcher_alerts (
    id SERIAL PRIMARY KEY,
    type VARCHAR(50) NOT NULL,          -- price_drop, new_product, bestseller, ...
    severity VARCHAR(20) DEFAULT 'info', -- info, warning, critical
    marketplace VARCHAR(30),
    seller_id VARCHAR(50),
    seller_name VARCHAR(200),
    sku VARCHAR(50),
    product_name VARCHAR(500),
    message TEXT NOT NULL,
    data JSONB,                          -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    status VARCHAR(20) DEFAULT 'unread', -- unread, read, dismissed
    created_at TIMESTAMPTZ DEFAULT NOW(),
    read_at TIMESTAMPTZ,
    read_by INTEGER REFERENCES users(id)
);

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–ª–µ—Ä—Ç–æ–≤
CREATE TABLE watcher_alert_settings (
    id SERIAL PRIMARY KEY,
    key VARCHAR(100) UNIQUE NOT NULL,
    value JSONB NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    updated_by INTEGER REFERENCES users(id)
);

-- –ü–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
CREATE TABLE watcher_subscriptions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    marketplace VARCHAR(30) NOT NULL,
    seller_id VARCHAR(50) NOT NULL,
    seller_name VARCHAR(200),
    notify_price_change BOOLEAN DEFAULT TRUE,
    notify_new_products BOOLEAN DEFAULT TRUE,
    notify_badges BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(user_id, marketplace, seller_id)
);

-- –ö—ç—à –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—á—ë—Ç–æ–≤
CREATE TABLE watcher_analytics_cache (
    id SERIAL PRIMARY KEY,
    cache_key VARCHAR(200) UNIQUE NOT NULL,
    data JSONB NOT NULL,
    expires_at TIMESTAMPTZ NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_wa_status ON watcher_alerts(status, created_at DESC);
CREATE INDEX idx_wa_seller ON watcher_alerts(seller_id, marketplace);
CREATE INDEX idx_ws_user ON watcher_subscriptions(user_id);
CREATE INDEX idx_wac_expires ON watcher_analytics_cache(expires_at);
```

---

## 6.9 –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å

### –ú–∞—Ç—Ä–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞

| –§—É–Ω–∫—Ü–∏—è | Staff | Manager | Senior | Director | Admin |
|---------|:-----:|:-------:|:------:|:--------:|:-----:|
| –ü—Ä–æ—Å–º–æ—Ç—Ä —Ü–µ–Ω –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –ê–ª–µ—Ä—Ç—ã (–ø—Ä–æ—Å–º–æ—Ç—Ä) | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –ü–æ–¥–ø–∏—Å–∫–∏ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ) | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| –ì–ª—É–±–æ–∫–∏–π AI-–∞–Ω–∞–ª–∏–∑ | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| –°—Ç–∞—Ç—É—Å Collector | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Collector | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–ª–µ—Ä—Ç–æ–≤ | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |

–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –±—Ä–µ–Ω–¥–∞–º (`brand_id`) –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ ADOLF Core Middleware –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Ä–æ–ª–µ–≤–æ–π –º–æ–¥–µ–ª—å—é.

---

## 6.10 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Analyzer)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|:------------:|----------|
| `WATCHER_COLLECTOR_URL` | `http://10.0.0.2:3002` | URL Collector REST API (—á–µ—Ä–µ–∑ VPN) |
| `WATCHER_KNOWLEDGE_DIR` | `/data/knowledge/incoming/watcher` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–∏—ë–º–∞ Markdown |
| `WATCHER_QDRANT_COLLECTION` | `competitive_intelligence` | –ö–æ–ª–ª–µ–∫—Ü–∏—è Qdrant |
| `WATCHER_ALERT_CHECK_INTERVAL` | `3600` | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–ª–µ—Ä—Ç–æ–≤ (—Å–µ–∫—É–Ω–¥—ã) |
| `WATCHER_ANALYTICS_TTL` | `21600` | TTL –∫—ç—à–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (—Å–µ–∫—É–Ω–¥—ã) |
| `WATCHER_AI_MODEL_ROUTINE` | `gpt-5-mini` | –ú–æ–¥–µ–ª—å –¥–ª—è —Ä—É—Ç–∏–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ |
| `WATCHER_AI_MODEL_DEEP` | `claude-opus-4-5` | –ú–æ–¥–µ–ª—å –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ |

---

**–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** –§–µ–≤—Ä–∞–ª—å 2026  
**–í–µ—Ä—Å–∏—è:** 4.0  
**–°—Ç–∞—Ç—É—Å:** –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è pending)
