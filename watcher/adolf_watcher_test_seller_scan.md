---
title: "Watcher v3.0: Тестовая сборка — Быстрый сканер каталога продавца"
description: "Пошаговая инструкция по сбору ассортимента конкурента со страницы продавца WB"
version: "0.1"
date: "Февраль 2026"
---

## Цель

Проверить работоспособность связки **Claude Code CLI + agent-browser** для быстрого сбора ассортимента конкурента. Агент получает ID продавца на Wildberries, пролистывает каталог и собирает данные со всех карточек-превью без захода на каждый товар.

## Отличия от варианта 1 (детальный осмотр)

| Параметр | Вариант 1: Детальный | Вариант 2: Быстрый сканер |
|----------|---------------------|--------------------------|
| Вход | Список артикулов (SKU) | ID продавца |
| Навигация | Поиск по артикулу → карточка товара | Страница продавца → пагинация |
| Глубина | Полная карточка товара | Превью из каталога |
| Эмуляция | Скролл, клик по фото, 40-50 сек пауза | Скролл каталога, умеренные паузы |
| Время на товар | ~70 сек | ~2-5 сек |
| Участие LLM | Калибровка + точечно при ошибках | Калибровка + пагинация |

## Требования

| Компонент | Требование |
|-----------|------------|
| ОС | Windows 10 (build 1809+) |
| RAM | 8 GB (минимум) |
| Подписка | Claude Max 5x |
| Браузер | Google Chrome (менеджер авторизован на WB) |
| Установлено | Claude Code CLI, agent-browser (см. Вариант 1, шаги 1-3) |

## Шаг 1: Подготовка рабочей директории

```powershell
mkdir -Force C:\watcher-test-seller
cd C:\watcher-test-seller
```

### 1.1 Тестовые продавцы

Создать файл `test_sellers.json`:

```json
{
  "marketplace": "wildberries",
  "sellers": [
    {"id": "1025130", "name": "Тестовый продавец"}
  ]
}
```

\{/* Замените ID на реального конкурента. Для теста достаточно одного продавца. */\}

### 1.2 Файл инструкций CLAUDE.md

Создать файл `CLAUDE.md` в корне проекта:

```markdown
# Watcher Agent — Быстрый сканер каталога продавца

## Роль
Ты — агент разведки ассортимента. Твоя задача: открыть страницу продавца
на Wildberries, пролистать весь каталог и собрать данные со всех
карточек-превью. Без захода на отдельные карточки товаров.

## Инструменты
Используй `agent-browser` для управления браузером.
Подключайся к Chrome через CDP: `agent-browser --cdp 9222`.

## Алгоритм работы

### Фаза 1: Инициализация
1. Прочитай файл test_sellers.json — получи список продавцов.
2. Подключись к Chrome через CDP: `agent-browser --cdp 9222 open about:blank`
3. Проверь подключение: `agent-browser get title`

### Фаза 2: Калибровка
1. Открой страницу первого продавца: https://www.wildberries.ru/seller/{id}
2. Дождись полной загрузки.
3. Выполни `agent-browser snapshot -i` на странице каталога.
4. Проанализируй snapshot — определи:
   - Структуру карточки-превью (какие данные видны: SKU, название, цена,
     старая цена, рейтинг, количество отзывов, скидка, бейджи).
   - Механизм пагинации (кнопка "Показать ещё", номера страниц,
     бесконечный скролл).
   - Общее количество товаров продавца (если отображается).
5. Сформируй схему извлечения данных из карточек-превью.
6. Определи метод пагинации.

### Фаза 3: Сбор данных

#### 3.1 Извлечение данных с текущей страницы
1. Выполни `agent-browser snapshot` для получения всех элементов.
2. Извлеки данные из каждой карточки-превью по схеме из Фазы 2.
3. Для каждого товара собери:
   - sku (артикул)
   - name (название)
   - price (текущая цена)
   - old_price (старая цена, если есть)
   - discount (скидка, если отображается)
   - rating (рейтинг, если виден)
   - reviews_count (количество отзывов, если видно)
   - image_url (URL первого фото, если доступен)
   - любые другие видимые данные (бейджи, промо-метки и т.д.)
4. Добавь извлечённые товары в общий массив результатов.

#### 3.2 Эмуляция поведения на странице каталога
Перед извлечением данных:
1. Подожди 2-3 секунды после загрузки.
2. Прокрути страницу плавно вниз до конца (несколько шагов скролла).
3. Подожди 1-2 секунды.
4. Прокрути обратно вверх.

#### 3.3 Пагинация
1. После извлечения данных с текущей страницы — перейди к следующей.
2. Wildberries может использовать разные механизмы пагинации:
   - **Кнопка "Показать ещё"** → кликни на неё, дождись загрузки новых карточек.
   - **Номера страниц** → кликни на следующую страницу.
   - **Бесконечный скролл** → прокрути вниз, дождись подгрузки.
3. Используй метод пагинации, определённый в Фазе 2.
4. После каждой загрузки новой порции товаров:
   - Подожди 3-5 секунд.
   - Выполни эмуляцию (скролл вниз-вверх).
   - Извлеки данные.
5. Повторяй пока не будут собраны все товары или не закончатся страницы.

#### 3.4 Эмуляция отвлечений
Раз в 3-7 страниц пагинации:
1. Кликни на случайную карточку товара.
2. Подожди 3-5 секунд на странице товара.
3. Вернись назад в каталог продавца.

### Фаза 4: Сохранение
1. Запиши все результаты в файл results_seller_{id}.json.
2. Выведи краткую сводку:
   - ID и имя продавца
   - Общее количество собранных товаров
   - Диапазон цен (мин — макс)
   - Средний рейтинг (если доступен)
3. Закрой вкладку (не браузер).

### Обработка ошибок
- Если пагинация сломалась (нет кнопки, страница не грузится) —
  сохрани собранные данные и завершись.
- При CAPTCHA — попробуй решить. Не удалось — подожди 5 минут,
  попробуй снова. Снова неудачно — сохрани собранное и завершись.
- При таймауте загрузки — подожди 10 секунд, обнови страницу, попробуй ещё раз.

## Формат результата (results_seller_{id}.json)

```json
{
  "seller_id": "1025130",
  "seller_name": "Название продавца",
  "marketplace": "wildberries",
  "scan_date": "2026-02-09T15:30:00Z",
  "total_products": 142,
  "products": [
    {
      "sku": "12345678",
      "name": "Худи оверсайз женское",
      "price": 2150,
      "old_price": 4300,
      "discount": 50,
      "rating": 4.8,
      "reviews_count": 256,
      "image_url": "https://...",
      "badges": ["Бестселлер"],
      "url": "https://www.wildberries.ru/catalog/12345678/detail.aspx"
    }
  ],
  "summary": {
    "price_min": 590,
    "price_max": 8900,
    "avg_rating": 4.6,
    "total_collected": 142,
    "pages_scanned": 5,
    "errors": 0
  }
}
```

## Ограничения
- Всегда подключайся к Chrome через `--cdp 9222`, не запускай отдельный Chromium.
- Не заходи на отдельные карточки товаров (кроме эмуляции отвлечений).
- Между загрузками страниц пагинации — пауза 3-5 секунд.
- При ошибке не останавливайся — сохрани собранное и продолжай.
```

## Шаг 2: Создать bat-файл

Создать `C:\watcher-test-seller\run_seller_scan.bat`:

```bat
@echo off
cd /d C:\watcher-test-seller

REM === Создать директорию для логов ===
if not exist logs mkdir logs

REM === 1. Принудительно закрыть Chrome ===
taskkill /F /IM chrome.exe >nul 2>&1
timeout /t 5 /nobreak >nul

REM === 2. Запустить Chrome с CDP и профилем менеджера ===
start "" "C:\Program Files\Google\Chrome\Application\chrome.exe" ^
  --remote-debugging-port=9222 ^
  --user-data-dir="%LOCALAPPDATA%\Google\Chrome\User Data" ^
  --profile-directory="Default" ^
  --no-first-run
timeout /t 10 /nobreak >nul

REM === 3. Запустить Claude Code CLI ===
claude --prompt "Прочитай CLAUDE.md и выполни задание. Используй agent-browser с --cdp 9222. Начни с Фазы 1." > logs\%date:~-4%-%date:~3,2%-%date:~0,2%_seller.log 2>&1

REM === 4. Закрыть Chrome после завершения ===
taskkill /F /IM chrome.exe >nul 2>&1
```

## Шаг 3: Запуск

```powershell
C:\watcher-test-seller\run_seller_scan.bat
```

Ожидаемое поведение:

1. Chrome откроется с профилем менеджера.
2. Claude подключится через CDP.
3. Откроет страницу продавца `wildberries.ru/seller/1025130`.
4. Проанализирует структуру каталога (1 вызов LLM).
5. Пролистает все страницы каталога, собирая данные с превью.
6. Сохранит `results_seller_1025130.json`.

Ориентировочное время: зависит от количества товаров у продавца. Для ~100 товаров — около 3-5 минут.

## Шаг 4: Проверка результатов

Открыть `results_seller_1025130.json` и проверить:

| Критерий | Ожидание |
|----------|----------|
| Файл создан | results_seller_1025130.json существует |
| seller_id | Совпадает с входным |
| products | Массив не пустой |
| Полнота | Количество products ≈ реальному количеству товаров продавца |
| Поля | Каждый товар содержит sku, name, price |
| summary | Присутствует сводка с min/max и количеством |

## Возможные проблемы

| Проблема | Причина | Решение |
|----------|---------|---------|
| Страница продавца не загружается | Неверный seller ID | Проверить ID в URL вручную |
| Собрано меньше товаров чем есть | Пагинация не определена | Увеличить паузы, проверить лог |
| Дубликаты товаров | Бесконечный скролл подгружает те же данные | Добавить дедупликацию по SKU |
| Пустые цены | Товар "нет в наличии" | Нормально — сохранить с пометкой |
| CDP connection refused | Chrome не запущен | Проверить `netstat -an \| findstr 9222` |
| Каталог пустой | Продавец скрыл товары или заблокирован | Попробовать другого продавца |

## Что дальше

После успешного теста:

1. Добавить несколько продавцов в `test_sellers.json`.
2. Комбинировать с Вариантом 1 — быстрый скан каталога для обнаружения новых SKU,
   затем детальный осмотр ключевых товаров.
3. Добавить Ozon и YM (у них другая структура страницы продавца).
4. Подключить отправку результатов на сервер через REST API.

---

**Версия:** 0.1  
**Статус:** Тестовая инструкция  
**Дата:** Февраль 2026
