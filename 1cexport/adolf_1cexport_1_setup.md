---
title: "Раздел 1: Настройка"
mode: "wide"
---

**Модуль:** 1Cexport \
**Версия:** 1.0 \
**Дата:** Февраль 2026

---

## 1.1 Требования

| Компонент | Требование |
|-----------|------------|
| Сервер 1С | Windows 7+ или Linux Ubuntu 20+ |
| Python | 3.8+ (установить для всех пользователей) |
| psycopg2 | `pip install psycopg2==2.8.4` |
| 1С:КА 2 | Проверено на 2.5.20.91 |
| Экстрактор | Лицензия «Экстрактор 1С» (18 000 ₽), [Infostart #1970328](https://infostart.ru/marketplace/1970328/) |
| Сеть | Открыт порт 5432 от сервера 1С до PostgreSQL |

---

## 1.2 Подготовка PostgreSQL

### Пользователь БД

Создать пользователя с минимальными правами — только INSERT и CREATE TABLE:

```sql
-- Выполнить от имени администратора PostgreSQL
CREATE USER "1c_writer" WITH PASSWORD '{SECURE_PASSWORD}';
GRANT CONNECT ON DATABASE adolf_db TO "1c_writer";
GRANT USAGE ON SCHEMA public TO "1c_writer";
GRANT CREATE ON SCHEMA public TO "1c_writer";
GRANT INSERT, SELECT ON ALL TABLES IN SCHEMA public TO "1c_writer";
ALTER DEFAULT PRIVILEGES IN SCHEMA public
    GRANT INSERT, SELECT ON TABLES TO "1c_writer";
```

<Warning>
Пользователь `1c_writer` не должен иметь права DELETE и UPDATE. Стратегия обновления данных — TRUNCATE &plus; INSERT (полная перезапись) для справочников, INSERT с перезаписью по ключу для регистров.
</Warning>

### Параметры подключения

| Параметр | Значение |
|----------|----------|
| Хост | \{ADOLF\_PG\_HOST\} |
| Порт | 5432 |
| База данных | adolf\_db |
| Пользователь | 1c\_writer |
| SSL | Да (сертификат CA) |

---

## 1.3 Установка Экстрактора в 1С

### Шаг 1: Подключение обработки

1. Скачать `.epf` файл (версия 1.3.8.4+) из личного кабинета Infostart
2. В 1С:КА 2 → Администрирование → Печатные формы, отчёты и обработки → Дополнительные обработки
3. Добавить обработку, загрузить `.epf` файл
4. Назначить команды:
   - «Фоновая выгрузка (все настройки)» — для запуска всех запросов
   - «Фоновая выгрузка №1..№10» — для индивидуальных запросов

### Шаг 2: Параметры подключения

На вкладке **«Настройки»** заполнить:

| Поле | Значение |
|------|----------|
| Тип | PostgreSQL |
| Имя базы | adolf\_db |
| Порт | 5432 |
| SSL | Включить |
| Путь до сертификата | Абсолютный путь к CA-сертификату |
| Пароль | Пароль пользователя 1c\_writer |
| Абсолютный путь Python | `python` (если PATH настроен) или полный путь |

### Шаг 3: Создание запросов

На вкладке **«Настройки запросов»** создать строки для каждого запроса из [реестра](/1cexport/adolf_1cexport_2_query_registry):

| Поле Экстрактора | Значение |
|-------------------|----------|
| Имя таблицы | `1C_{table_name}` (например `1C_account_turns_90`) |
| Текст запроса | Из конструктора запросов (см. реестр) |
| Использовать период в ключе | Да (для регистров), Нет (для справочников) |
| Количество дней назад | Зависит от запроса (1, 7, 30) |
| Периодичность | День или Месяц |

<Warning>
Ограничение Экстрактора: до 10 фоновых заданий с индивидуальным расписанием. При 18 запросах группировать запросы с одинаковым расписанием или использовать «Фоновая выгрузка (все настройки)» с общим расписанием.
</Warning>

### Шаг 4: Тестирование

1. Выбрать один запрос (рекомендуется Q-10: Номенклатура — небольшой объём)
2. Установить период 1 день
3. Нажать **«Отправить запрос»** (ручной режим)
4. Проверить в PostgreSQL: `SELECT count(*) FROM "1C_nomenclature";`
5. При успехе — настроить фоновую выгрузку по расписанию

### Шаг 5: Фоновая выгрузка

Для файлового варианта базы:

1. Создать пользователя 1С `exchange` (сервисный)
2. Добавить задание в планировщик Windows / cron
3. Расписание — см. [Раздел 3: Расписание](/1cexport/adolf_1cexport_3_schedule)

Для клиент-серверного варианта:

1. Использовать встроенные регламентные задания 1С
2. Назначить команду «Фоновая выгрузка №N» на расписание

---

## 1.4 Сохранение/восстановление конфигурации

Экстрактор поддерживает экспорт/импорт настроек в JSON:

| Действие | Кнопка |
|----------|--------|
| Сохранить | «Сохранить настройки обработки в файл» |
| Загрузить | «Загрузить настройки обработки из файла» |

Рекомендуется хранить конфигурационный файл в системе контроля версий или резервных копиях.

---

## 1.5 Проверка работоспособности

| Проверка | Команда / действие |
|----------|--------------------|
| Подключение к БД | Ручная отправка тестового запроса |
| Таблицы созданы | `\dt 1C_*` в psql |
| Данные загружены | `SELECT count(*), max(loaded_at) FROM "1C_{table}";` |
| Фоновые задания | Проверка логов 1С / журнала регистрации |

---

**Версия:** 1.0 \
**Статус:** Черновик
