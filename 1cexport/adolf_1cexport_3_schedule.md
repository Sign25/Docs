---
title: "Раздел 3: Расписание и мониторинг"
mode: "wide"
---

**Модуль:** 1Cexport \
**Версия:** 1.0 \
**Дата:** Февраль 2026

---

## 3.1 Сводное расписание

| Время | Пн | Вт–Пт | 1-е число месяца | 1-е число квартала |
|:-----:|:--:|:------:|:---------:|:------------------:|
| 05:00 | Q-10, Q-11 | — | Q-12 | Q-12 |
| 05:30 | Q-13, Q-17 | — | — | — |
| 06:00 | Q-06 | Q-06 | Q-06 | Q-06 |
| 06:15 | Q-07 | Q-07 | Q-07 | Q-07 |
| 06:30 | Q-08 | Q-08 | Q-08 | Q-08 |
| 06:45 | Q-09 | Q-09 | Q-09 | Q-09 |
| 06:50 | Q-18 | Q-18 | Q-18 | Q-18 |
| 07:00 | Q-01, Q-14 | Q-14 | Q-01, Q-14 | Q-01, Q-14 |
| 07:15 | Q-15 | — | Q-15 | Q-15 |
| 07:30 | Q-04 | — | Q-04 | Q-04 |
| 09:00 | — | — | Q-02, Q-03 | Q-02, Q-03, Q-16 |
| 10:00 | — | — | Q-05 | Q-05 |

---

## 3.2 Статистика по периодичности

| Периодичность | Запросы | Кол-во |
|---------------|---------|:------:|
| Ежедневно | Q-06, Q-07, Q-08, Q-09, Q-14, Q-18 | 6 |
| Еженедельно (Пн) | Q-01, Q-04, Q-10, Q-11, Q-13, Q-15, Q-17 | 7 |
| Ежемесячно (1-е число) | Q-02, Q-03, Q-05, Q-12 | 4 |
| Ежеквартально | Q-16 | 1 |
| **Итого** | | **18** |

---

## 3.3 Группировка для Экстрактора

Экстрактор поддерживает до 10 индивидуальных фоновых заданий. Группировка запросов с одинаковым расписанием:

| Фоновое задание | Запросы | Расписание |
|:---------------:|---------|------------|
| №1 | Q-06, Q-07, Q-08, Q-09, Q-18 | Ежедневно 06:00 |
| №2 | Q-14 | Ежедневно 07:00 |
| №3 | Q-10, Q-11 | Еженедельно Пн 05:00 |
| №4 | Q-13, Q-17 | Еженедельно Пн 05:30 |
| №5 | Q-01, Q-04 | Еженедельно Пн 07:00 |
| №6 | Q-15 | Еженедельно Пн 07:15 |
| №7 | Q-02, Q-03, Q-05 | Ежемесячно 1-е число 09:00 |
| №8 | Q-12 | Ежемесячно 1-е число 05:00 |
| №9 | Q-16 | Ежеквартально 1-е число 09:00 |

Итого: 9 заданий (в пределах лимита 10).

---

## 3.4 Мониторинг свежести данных

Celery-задача проверяет `loaded_at` в каждой таблице `1C_*`. Алерт при превышении порога.

### Пороги свежести

| Таблица | Макс. возраст | Уровень алерта |
|---------|:-------------:|:--------------:|
| `1C_stock_balance` (Q-06) | 26 часов | critical |
| `1C_customer_orders` (Q-07) | 26 часов | critical |
| `1C_supplier_orders` (Q-08) | 26 часов | warning |
| `1C_goods_receipts` (Q-09) | 26 часов | warning |
| `1C_sales` (Q-14) | 26 часов | warning |
| `1C_stock_turnover` (Q-18) | 26 часов | warning |
| `1C_account_turns_90` (Q-01) | 8 дней | warning |
| `1C_nomenclature` (Q-10) | 8 дней | info |
| Остальные | 35 дней | info |

### Запрос проверки свежести

```sql
SELECT
    table_name,
    max(loaded_at) AS last_loaded,
    now() - max(loaded_at) AS age
FROM (
    SELECT '1C_stock_balance' AS table_name, max(loaded_at) AS loaded_at FROM "1C_stock_balance"
    UNION ALL
    SELECT '1C_customer_orders', max(loaded_at) FROM "1C_customer_orders"
    UNION ALL
    SELECT '1C_nomenclature', max(loaded_at) FROM "1C_nomenclature"
    -- ... аналогично для остальных таблиц
) t
GROUP BY table_name
ORDER BY age DESC;
```

### Интеграция с системой уведомлений

При срабатывании алерта — уведомление через механизм, описанный в [Core: Notifications](/core/adolf_core_2_5_postgresql). Получатели: роли Director и Administrator.

---

## 3.5 Стратегии обновления данных

| Стратегия | Таблицы | Описание |
|-----------|---------|----------|
| TRUNCATE &plus; INSERT | Q-10..Q-13 (справочники) | Полная перезапись, исключает проблему удалённых записей |
| INSERT с глубиной | Q-01..Q-09, Q-14..Q-18 (регистры, документы) | Перезапись за период «глубины», старые записи остаются |

<Warning>
При INSERT с глубиной записи с одинаковым ключом заменяются новыми (upsert по ключу таблицы Экстрактора). Если данные изменены в 1С за пределами «глубины», они не обновятся автоматически — требуется ручная переотправка за нужный период.
</Warning>

---

**Версия:** 1.0 \
**Статус:** Черновик
